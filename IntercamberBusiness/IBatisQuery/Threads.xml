<?xml version="1.0" encoding="utf-8" ?>
<sqlMap namespace="Intercamber.Dao.Threads" xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
    <alias>
        <typeAlias alias="Threads" type="CML.Intercamber.Business.Model.Threads"/>
    </alias>

	<resultMaps>
        <resultMap id="ThreadsResult" class="Threads">
			<result property="IdThread" column="IdThread" />
			<result property="IdTypeThread" column="IdTypeThread" />
			<result property="DateCreate" column="DateCreate" />
        </resultMap>
    </resultMaps>

    
     <alias>
        <typeAlias alias="ThreadDetail" type="CML.Intercamber.Business.Model.ThreadDetail"/>
    </alias>
    <resultMaps>
        <resultMap id="ThreadsDetailResult" class="ThreadDetail">
			<result property="IdThread" column="IdThread" />
			<result property="IdUser" column="IdUser" />
            <result property="FirstName" column="FirstName" />
            <result property="LastName" column="LastName" />
        </resultMap>
    </resultMaps>
    
	<statements>

        <select id="CML.Intercamber.Threads.UserThreads" resultMap="ThreadsDetailResult" parameterClass="long">
            SELECT t.IdThread, u.IdUser, uu.FirstName, uu.LastName
            FROM Threads t 
            INNER JOIN ThreadUsers tu on tu.IdThread = t.IdThread and tu.IdUser = #value#
            INNER JOIN ThreadUsers u on u.IdThread = tu.IdThread and u.Iduser != #value#
            INNER JOIN Users uu on uu.IdUser = u.IdUser
        </select>
        
        <select id="CML.Intercamber.Threads.ThreadDetailsById" resultMap="ThreadsDetailResult" parameterClass="long">
            SELECT t.IdThread, u.IdUser, uu.FirstName, uu.LastName
            FROM Threads t 
            INNER JOIN ThreadUsers u on u.IdThread = t.IdThread
            INNER JOIN Users uu on uu.IdUser = u.IdUser
            WHERE t.IdThread = #value#
        </select>
        
        
        <update id="CML.Intercamber.Threads.UpdateThreads" parameterClass="Threads" >
            UPDATE Threads
            SET IdThread = #IdThread#, IdTypeThread = #IdTypeThread#, DateCreate = #DateCreate#
            WHERE 
				TODO
        </update>

        <insert id="CML.Intercamber.Threads.InsertThreads" parameterClass="Threads">
			INSERT INTO Threads (IdThread, IdTypeThread, DateCreate)
			VALUES ( #IdThread#, #IdTypeThread#, #DateCreate# )
        </insert>

        <delete id="CML.Intercamber.Threads.DeleteThreads" parameterClass="string">
            DELETE FROM Agent 
			WHERE 
				TODO 
        </delete>

    </statements>

</sqlMap>
